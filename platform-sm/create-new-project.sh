#!/bin/bash

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –ø–µ—Ä–µ–¥–∞–Ω–æ –ª–∏ –∏–º—è –ø—Ä–æ–µ–∫—Ç–∞
if [ -z "$1" ]; then
  echo "‚ùå –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./create-new-project.sh <–Ω–∞–∑–≤–∞–Ω–∏–µ_–ø—Ä–æ–µ–∫—Ç–∞>"
  exit 1
fi

PROJECT_NAME=$1
PROJECT_PATH="./$PROJECT_NAME"

echo "üöÄ –°–æ–∑–¥–∞—ë–º –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç: $PROJECT_NAME..."

# 1. –ö–æ–ø–∏—Ä—É–µ–º —à–∞–±–ª–æ–Ω –ø—Ä–æ–µ–∫—Ç–∞ –≤ –Ω–æ–≤—É—é –ø–∞–ø–∫—É
cp -r ./template "$PROJECT_PATH"

# 2. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞
cd "$PROJECT_PATH" || exit

# 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–æ–≤—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π Git
git init
git add .  # –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git commit -m "Initial commit"  # –î–µ–ª–∞–µ–º –ø–µ—Ä–≤—ã–π –∫–æ–º–º–∏—Ç

# 4. –ö–æ–ø–∏—Ä—É–µ–º ENV-—Ñ–∞–π–ª –∏ –∑–∞–º–µ–Ω—è–µ–º –∏–º—è –ø—Ä–æ–µ–∫—Ç–∞
cp .env.example .env
sed -i "s/PROJECT_NAME/$PROJECT_NAME/g" .env

# 5. –ó–∞–ø—É—Å–∫–∞–µ–º Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
echo "üê≥ –ó–∞–ø—É—Å–∫–∞–µ–º Docker..."
docker-compose up -d

echo "‚úÖ –ü—Ä–æ–µ–∫—Ç $PROJECT_NAME —Å–æ–∑–¥–∞–Ω –∏ –∑–∞–ø—É—â–µ–Ω! –î–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É http://$PROJECT_NAME.local"
